---
comments: false
date: 2008-04-24
layout: post
permalink: /2008/04/password-protecting-your-site.php
title: Password protecting your site
---

<h1>{{ page.title }}</h1>
<div class='post'>
I wanted to loosely password protect my website. I wanted to do this so that search engines wouldn't index the site and so that random people I didn't know wouldn't read it (without some work) but so that it was easy as pie for people I did know to get in and see what they want.<br /><br />The solution I came up with was a form that asks for a password (there are no user names) and if you enter it correctly sets a cookie on your browser that should last for a year. Every time you visit the site your cookie life is extended. So as long as you come to the site at least once a year it should never ask you for a password again. I made the password ridiculously easy that anyone who knew me would know the answer to. I also made it possible to have a list of acceptable passwords so you could ask for the name of one of my cats and any correct name would get you in.<br /><br />I didn't want to use basic http auth since there's not enough room to explain why you're asking for a password or to give hints about what might work and it also requires a username which further complicates matters, you can only tell people what to enter after they have failed once, and that's a bad user experience.<br /><br />The devil's in the details of course, I usually run <a href="https://addons.mozilla.org/en-US/firefox/addon/2497">Cookie Safe</a> which selectively allows me to allow sites to set cookies and I'm very frustrated when a page tries to set cookies, fails, but doesn't tell me. So I try and detect that scenario and report an error if it happens. If you're only allowing session cookies I try and set one of those too, but then you'll need to type a password next time you visit.<br /><br />I also wanted it to be modular, so I could use the same code from many pages, so I made it a php include that you could use with only a small amount of code in the page you're protecting (your blogger template for example).<br /><br />Here's how you use it<br /><br />1. download <a href="http://wtwf.com/scripts/bin/restrict.txt">restrict.php</a> and save it as restrict.php somewhere on your server. <br /><br />2. Create a page with the form users will enter the password on. A minimal example is included below:<pre class="code">&lt;?php<br />if (isset($ARK_RESTRICT_ERROR)) {<br />  print "&lt;h1&gt;$ARK_RESTRICT_ERROR&lt;/h1&gt;\n";<br />}<br />?&gt;<br />&lt;p&gt;Access to this site is restricted!&lt;/p&gt;<br /><br />&lt;p&gt;Please enter my favorite color:&lt;br /&gt;           <br />&lt;form method="post" action="&lt;?php echo CurrentPageUrl() ?&gt;"&gt;        <br />&lt;input type="text" name="answer" /&gt;                                       <br />&lt;input type="submit" value="submit"/&gt;                                     <br />&lt;/form&gt;                                                                   </pre>However, remember, this is the page search engines will see, so you might want to include a:<pre class="code">&lt;meta name="ROBOTS" content="NOINDEX,NOFOLLOW" /&gt;</pre>at the top and perhaps some better instructions or explaining why you do this. You might want to use the same template you use on the rest of your site?<br /><br />3. Now for every page you want to protect you need to add this at the very very top of the page:<pre class="code">&lt;php<br />  $ARK_RESTRICT_ANSWERS = array('red', 'no', 'blue', 'arghhh');<br />  $ARK_RESTRICT_FORM = '/www/html/form.php';<br />  include_once('/www/html/restrict.php');<br />?&gt;</pre>Make sure you add it at the very very top, since it sets some cookies and senders a Location: HTTP header if anything is output before it runs there will be errors.<br /><br />Note how you provide the paths to the files on the web server machine (do not use urls).<br /><br />Thats it, should just work now. Hope you find it useful.<br /><br />Possible improvements:<br /><br />TODO(ark) add a long error description variabletoo<br />TODO(ark) try and set cookies using javascript and report an error if there is one before the user even tries a password.</div>
<h2>Comments</h2>
<div class='comments'>
</div>
