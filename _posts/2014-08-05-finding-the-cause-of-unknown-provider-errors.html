---
layout: post
title: Finding the cause of “Unknown provider” errors
date: 2014-08-05
comments: false
---

<h1>{{ page.title }}</h1>
<div class='post'>
My boss IM'd me Sunday morning asking what broke in our Angular app. The only error message on the console was the dreaded.<br /><br /><pre class="default prettyprint prettyprinted" style="background: rgb(238, 238, 238); border: 0px; font-family: Consolas, Menlo, Monaco, 'Lucida Console', 'Liberation Mono', 'DejaVu Sans Mono', 'Bitstream Vera Sans Mono', 'Courier New', monospace, serif; font-size: 14px; line-height: 17.8048000335693px; margin-bottom: 10px; max-height: 600px; overflow: auto; padding: 5px; vertical-align: baseline; width: auto; word-wrap: normal;"><code style="background-attachment: initial; background-clip: initial; background-image: initial; background-origin: initial; background-position: initial; background-repeat: initial; background-size: initial; border: 0px; font-family: Consolas, Menlo, Monaco, 'Lucida Console', 'Liberation Mono', 'DejaVu Sans Mono', 'Bitstream Vera Sans Mono', 'Courier New', monospace, serif; margin: 0px; padding: 0px; vertical-align: baseline; white-space: inherit;"><span class="typ" style="background: transparent; border: 0px; color: #2b91af; margin: 0px; padding: 0px; vertical-align: baseline;">Error</span><span class="pun" style="background: transparent; border: 0px; margin: 0px; padding: 0px; vertical-align: baseline;">:</span><span class="pln" style="background: transparent; border: 0px; margin: 0px; padding: 0px; vertical-align: baseline;"> </span><span class="pun" style="background: transparent; border: 0px; margin: 0px; padding: 0px; vertical-align: baseline;">[</span><span class="pln" style="background: transparent; border: 0px; margin: 0px; padding: 0px; vertical-align: baseline;">$injector</span><span class="pun" style="background: transparent; border: 0px; margin: 0px; padding: 0px; vertical-align: baseline;">:</span><span class="pln" style="background: transparent; border: 0px; margin: 0px; padding: 0px; vertical-align: baseline;">unpr</span><span class="pun" style="background: transparent; border: 0px; margin: 0px; padding: 0px; vertical-align: baseline;">]</span><span class="pln" style="background: transparent; border: 0px; margin: 0px; padding: 0px; vertical-align: baseline;"> </span><span class="typ" style="background: transparent; border: 0px; color: #2b91af; margin: 0px; padding: 0px; vertical-align: baseline;">Unknown</span><span class="pln" style="background: transparent; border: 0px; margin: 0px; padding: 0px; vertical-align: baseline;"> provider</span><span class="pun" style="background: transparent; border: 0px; margin: 0px; padding: 0px; vertical-align: baseline;">:</span><span class="pln" style="background: transparent; border: 0px; margin: 0px; padding: 0px; vertical-align: baseline;"> eProvider </span><span class="pun" style="background: transparent; border: 0px; margin: 0px; padding: 0px; vertical-align: baseline;">&lt;-</span><span class="pln" style="background: transparent; border: 0px; margin: 0px; padding: 0px; vertical-align: baseline;"> e</span></code></pre><div>It all worked fine in our dev environment, it was only the minified version that had the problem. The cause of this is well known, see <a href="https://docs.angularjs.org/tutorial/step_05">A Note on Minification</a> on the AngularJS website. So somewhere I have something like `.run(function(e){...})` in my minified code and I just have to find it. Unluckily for me, I had just been through a huge code organizing binge and pretty much touched every source file and was particularly messing with the layout of our injectable blocks.</div><div><br /></div><div>Looking at the 57 line 1.4Meg compiled javascript file I found 4017 functions that take 'e' as a parameter ` egrep -o 'function\([^)]*\be' `. That's just under half of all the functions in the file.</div><div><br /></div><div>To find the problem I modified the uglifyjs JavaScript compiler to create a globally unique id every time an id was created.</div><div><br /></div><div><span style="background-color: #eeeeee; font-family: Consolas, Menlo, Monaco, 'Lucida Console', 'Liberation Mono', 'DejaVu Sans Mono', 'Bitstream Vera Sans Mono', 'Courier New', monospace, serif; font-size: 14px; line-height: 17.8048000335693px; white-space: pre-wrap;">./bin/uglifyjs --unique_ids original.min.js &gt;new.min.js</span></div><div><br /></div><div>I ran the minified code through uglify and then served up this new code and sure enough I got an Unknown provider: e453Provider &lt;- e453</div><div>Trolling through the minified code it was easy to find the block where e453 was and with a bit of poking around I could find where the problem was. Root cause: someone checked in <a href="http://chieffancypants.github.io/angular-hotkeys/">hotkeys.js</a> from the src/ directory and not the build/ directory...</div><div><br /></div><div>I have a pull request pending to add my flag to uglifyjs but until that happens (or if it doesn't) you can download it here:&nbsp;<a href="https://github.com/arkarkark/UglifyJS">https://github.com/arkarkark/UglifyJS</a></div><div><br /></div><div>This was my first time playing with some node.js code.</div><div><br /></div><div>I also added my answer to this Stack Overflow question (and finally started building some reputation there):&nbsp;<a href="http://stackoverflow.com/questions/22197191/finding-the-cause-of-unknown-provider-errors">Finding the cause of “Unknown provider” errors</a>.</div></div>
<h2>Comments</h2>
<div class='comments'>
</div>
